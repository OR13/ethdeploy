## ethdeploy | webpack for smart-contracts ;)

A first pass at a highly configurable contract staging and deployment utility.

Made with ❤︎ by Nick Dodson. If you're using this tool, we'd love to hear from you!

## Features
  - Highly unopinionated
  - Just deployment, that's it! (does not compile or tests contracts, but plugins though ;=D)
  - Composable, to be integrated into other things like `webpack` loaders, the `cli` or any other frameworks
  - Extremely configurable (deploy contracts with different settings to multiple environments in different ways)
  - Extensible, deployment staging can happen in any environment to any environment
  - Lightly abstracted, promisified but mostly unopinionated deployment scripting (maybe no promises in the future though)
  - Lightweight, does not include a ton of dependencies
  - Simple and robust, intakes data/config >> outputs result data
  - Is meant to aid in contract deployment, not dictate entire application design

## About

Deploy your Ethereum smart-contracts to multiple environments, with a range of configurations, using lightly abstracted promisified deployment staging modules. The end result is an environments object, that contains all configured contract information (e.g. address, receipt, gas, abi, etc.) for each selected environment and their contracts.

## Installation

```
npm install --save ethdeploy
```

## Example

Checkout the ethdeploy [example](/example/index.js) provided. Run a [testrpc](http://github.com/ethereumjs/ethereumjs-testrpc) instance, then run the example npm command `npm run example`. This will deploy a bunch of contracts with an ethdeploy setup and config.

```
testrpc
npm run example
```

## CLI

If you would like to use `ethdeploy` off a CLI, use [ethdeploy-cli](http://github.com/silentcicero/ethdeploy-cli):

```
npm install -g ethdeploy-cli

ethdeploy  ./ethdeploy.config.js  ./outputDir/
```

## Input Description

Feed `ethdeploy` a deploy module, the compiled contracts and config object and it will deploy your contracts the way you want, where you want it and spit out a single object

  1. environment (the node or infrastructure you are deploying too)
  2. deploy script module (a simple, lightly abstracted build script module)
  3. contracts object (usually the output of the solc compiler [i.e. the `output.contracts`])
  4. config object (a vanilla object that usually resides in the package.json file under `ethdeploy`);

## Example Input Object

```js
const contracts = require('./lib/classes.json');

module.exports = {
  output: {
    environment: 'testrpc',
  },
  entry: {
    testrpc: contracts,
  },
  module: function(deploy, contracts, environment){
    deploy(contracts.SimpleStoreRegistry).then(function(simpleStoreRegistry){
      deploy(contracts.SimpleStoreFactory, simpleStoreRegistry.address).then(function(factoryInstance){
        deploy(contracts.CustomSimpleStore);
        deploy(contracts.AnotherCustomSimpleStore).then(function(contractInstance){
        });
      });
    });
  },
  config: {
    defaultAccount: 0,
    defaultGas: 3000000,
    environments: {
      testrpc: {
        provider: {
          type: 'http',
          host: 'http://localhost',
          port: 8545,
        },
        objects: {
          CustomSimpleStore: {
            class: 'SimpleStore',
            from: 2, // a custom account
            gas: 2900000, // some custom gas
          },
          AnotherCustomSimpleStore: {
            class: 'SimpleStore',
            from: 1, // a custom account
            gas: 2900000, // some custom gas
          },
        },
      },
    },
  },
};
```

## Example Output Object

This is an example object generated by ethdeploy. The object describes each environment and their relevant contracts. The core property of each contract instance deployed is the address property, everything else is optionally configured.

```json
{
  "testrpc": {
    "SimpleStore": {
      "address": "0x179895ccb2a149d07ecab8ff50c57fca808c32c4",
      "gas": 3000000,
      "from": "0xcd8175afaec49803b22cae09879ea38feeb892bb",
      "transactionHash": "0x03d28dd1fcd322b221b00b48aaf60627b7854478e28297843b52848aa7f9d239"
    },
    "SomeCustomInstance": {
      "address": "0x6bfb8dcf73157c2003b3ad33c3253f92df5156b6",
      "gas": 2900000,
      "from": "0x8ea1c64b7ecca5a850d4d37841b65d2fef1c212b",
      "transactionHash": "0x8818179302adb0be04823eb367abc676e1a88358f2ca137687244661952d19f9"
    }
  }
}
```

## Ethdeploy Provider Module System

ethdeploy allows you to build your own provider modules. At this point, ethdeploy provider modules must be prefixed in a specific way. If your provider `type` is specified as "http" for example, the npm module "ethdeploy-provider-http" must be installed, as it will be `require`d and used in the deployment staging. Note, this provider module naming convention will be less opinionated in the future.

The provider module API is as follows:

```js
module.exports = function(providerObject) {
  return // Your web3 provider object
}
```

Here, `providerObject` is simply the object specified in the ethdeploy environment config, here is a standard web3 HTTP provider for example:

```js
'provider': {
  'type': 'http',
  'host': 'http://localhost',
  'port': 8545,
},
```

Where the provider `type` property is actually specifying the provider module (e.g. `http` => `ethdeploy-provider-http`). This design pattern is once again similar to the `webpack` loader system.

## Environment Selection
You can either deploy to "all" or a specific environment by setting the `environment` property.

```
environment: 'testrpc',
```

## Providers
 - [ethdeploy-provider-http](http://github.com/silentcicero/ethdeploy-provider-http)
 - [ethdeploy-provider-zero-client](http://github.com/silentcicero/ethdeploy-provider-zero-client)

## Future Todo/Design Considerations
 - Don't use promises by default for deployment staging (allow users to make plugins for this)
 - Enable pre-loader and post-loader staging for contract deployment
 - Enable promisified or sync classes object return
 - Great unit tests ;)
 - Make configuration more awesome (the current intake input is cool, but could be far more configurable)
 - Make provider module naming conventions/requirements less opinionated

## Deploying To Testnet/Livenet
 You can now easily deploy contracts off ethdeploy using the [ethdeploy-provider-zero-client](http://github.com/ethdeploy-provider-zero-client). See the `example/ethdeploy-zero-client.config.js` for more configuration details.

## Design Philosophy
 - Unix Philosophy
 - Webpack like (hard to setup, awesome when it's working =D)

## Things We Would Like To Use and Be Compatible With `ethdeploy`
  - Truffle
  - Dapple
  - Embark
  - Any other frameworks..

## Licence

Released under the MIT License, see [LICENSE.md](LICENSE.md) file.
